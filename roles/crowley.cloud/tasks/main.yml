# file: roles/crowley.cloud/tasks/main.yml
---
- name: Install packages(git,curl)
  apt: name={{item}} state=present
  with_items:
    - curl
    - git
- name: Adding boto
  pip: name=boto state=present
- name: Copy github keys from local
  authorized_key:
    user: ubuntu
    state: present
    key: "{{ lookup('file', '/Users/cheez/.ssh/hardhero-github-readonly') }}"
- name: change permissions on github key
  file: path={{ssh_dir}}/{{github_key_name}} mode=700
- name: clone git repo
  git: repo={{git_link}}
       dest={{download_dir}}
       accept_hostkey=yes
       force=yes
       key_file={{ssh_dir}}/{{github_key_name}}
       recursive=yes
- name: create crowley.cloud html directory
  file:
    path: {{crowley_cloud_html_dir}}
    state: directory
    owner: {{nginx_user}}
    group: www-data
- name: copy crowley-cv files to html root
  copy:
    src: /srv/myfiles/foo.conf
    dest: {{crowley_cloud_html_dir}}
    owner: foo
    group: foo
    mode: 0644
  with_fileglob:
  - "{{download_dir}}/resume/*.css"
  - "{{download_dir}}/resume/index.html"
  notify: nginx restart
- name: add healthcheck.html
  template:
    src: templates/healthcheck.html.j2
    dest: "{{crowley_cloud_html_dir}}/healthcheck.html "
    owner: "{{nginx_user}}"
    group: www-data
    mode: 0644
